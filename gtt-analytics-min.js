class AnalyticsUtils{constructor(){this.domCache={}}getCachedElement(t,e=null){const o=e||t;return this.domCache[o]||(this.domCache[o]=document.querySelector(t)),this.domCache[o]}getCachedElements(t,e=null){const o=e||t;return this.domCache[o]||(this.domCache[o]=document.querySelectorAll(t)),this.domCache[o]}triggerUtagView(t,e={}){const o=Object.assign({},t,e);"undefined"!=typeof utag?utag.view(o):console.log("Could not trigger utag.view method.")}triggerUtagLink(t,e=null,o={}){const r=Object.assign({},o);e&&(r.tealium_event=e),"undefined"!=typeof utag?utag.link(r):console.log(`Could not trigger utag.link method for event: ${e||"unknown"}`)}triggerUtagTrack(t,e){window.utag&&"function"==typeof utag.track&&utag.track(t,e)}QueryStringToJSON(){var t=location.search.slice(1).split("&"),e={};return t.forEach(function(t){t=t.split("="),e[t[0]]=decodeURIComponent(t[1]||"")}),e}setDataPointByDataPropertyName(t,e,o){var r=$("span["+e+"]").eq(0).attr(e);r&&(t[o]=r)}getProductsDataFromQueryString(t){var e=null;try{e=this.QueryStringToJSON()}catch(t){}return e&&e.productId?window.productHandler.parseProductsData(t,e):null}parseJsonFromElement(t){try{const e=document.getElementById(t);return e?this.safeJsonParse(e.innerHTML):null}catch(e){return console.error(`Error parsing JSON from element ${t}:`,e),null}}safeJsonParse(t){if(!t||"string"!=typeof t)return null;try{const e=t.replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/");return JSON.parse(e)}catch(e){return console.error("JSON parse failed:",e,"Input:",t),null}}parsePrice(t){if(!t)return 0;const e=t.toString().replace(/[$,\s]/g,""),o=parseFloat(e);return isNaN(o)?0:o}countTextCharacters(t){let e=0;return t.forEach(t=>{e+=t.innerText.trim().length}),e}extractTextData(t){const e=[],o=[];return Array.from(t).forEach(t=>{const r=t.innerText.trim();r.length>0&&(e.push(r),o.push(r.length.toString()))}),{texts:e,lengths:o}}static queryStringToJSON(t=null){const e=t||window.location.search;if(!e||e.length<=1)return{};const o=e.substring(1).split("&"),r={};return o.forEach(t=>{if(t){const[e,o]=t.split("=");if(e)try{r[decodeURIComponent(e)]=o?decodeURIComponent(o):""}catch(t){console.warn("Failed to decode query parameter:",e,o),r[e]=o||""}}}),r}static isValidEmail(t){if(!t||"string"!=typeof t)return!1;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static isValidPhone(t){if(!t||"string"!=typeof t)return!1;const e=t.replace(/\D/g,"");return 10===e.length||11===e.length&&"1"===e[0]}static formatPhone(t){if(!t)return"";const e=t.replace(/\D/g,"");return 10===e.length?`(${e.slice(0,3)}) ${e.slice(3,6)}-${e.slice(6)}`:11===e.length&&"1"===e[0]?`+1 (${e.slice(1,4)}) ${e.slice(4,7)}-${e.slice(7)}`:t}static cleanUrl(t){if(!t||"string"!=typeof t)return"";try{return new URL(t,window.location.origin).pathname}catch(e){return console.warn("Invalid URL:",t),t}}static extractDomain(t){if(!t||"string"!=typeof t)return"";try{return new URL(t).hostname}catch(e){return console.warn("Invalid URL for domain extraction:",t),""}}static sanitizeString(t,e=100){if(!t||"string"!=typeof t)return"";let o=t.replace(/['"\\]/g,"").replace(/\s+/g," ").trim();return o.length>e&&(o=o.substring(0,e-3)+"..."),o}static getCurrentTimestamp(t="iso"){const e=new Date;switch(t){case"unix":return Math.floor(e.getTime()/1e3);case"readable":return e.toLocaleDateString()+" "+e.toLocaleTimeString();default:return e.toISOString()}}static deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>this.deepClone(t));const e={};return Object.keys(t).forEach(o=>{e[o]=this.deepClone(t[o])}),e}static mergeObjects(t,e,o=!0){const r=this.deepClone(t);return Object.keys(e).forEach(t=>{!o&&t in r||(r[t]=this.deepClone(e[t]))}),r}static isElementVisible(t){if(!t)return!1;const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}static debounce(t,e){let o;return function(...r){clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),t(...r)},e)}}static throttle(t,e){let o;return function(...r){o||(t.apply(this,r),o=!0,setTimeout(()=>o=!1,e))}}generateUID(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static logError(t,e={},o=null){const r={message:t,context:e,timestamp:this.getCurrentTimestamp(),url:window.location.href,userAgent:navigator.userAgent};o&&(r.stack=o.stack,r.originalMessage=o.message),console.error("Analytics Error:",r),window.gtag&&"function"==typeof window.gtag&&window.gtag("event","exception",{description:t,fatal:!1})}}class ProductHandler{static PRODUCT_FIELDS=["itemMake","itemYear","productId","productExternalId","isUnitInventory","itemOnSale","name","unitPrice","itemType","itemTypeId","itemIndustry","productOwnerId","itemOriginalPrice","vin","primaryColor"];static UTAG_MAPPINGS={product_list_makes:"makes",product_list_years:"years",product_list_ids:"ids",product_list_names:"names",product_list_types:"types",product_list_on_sale:"onSales",product_list_prices:"prices",product_list_categories:"categories",product_list_category_ids:"categoryIds",product_list_industries:"industries",product_list_make_ids:"makeIds",product_list_msrp:"msrps",product_list_vins:"vins",product_list_external_colors:"externalColors",product_external_id:"productExternalIds",product_external_platform:"productExternalPlatforms",product_list_did_active:"activePromotions"};constructor(){this.domCache={visitorsCount:null,promoMessage:null,spin360:null,financingAnchor:null}}parseJsonElement(t){return window.analyticsUtils.parseJsonFromElement(t)}getDOMElement(t,e){return this.domCache[e]||(this.domCache[e]=document.querySelector(t)),this.domCache[e]}getProductAnalyticsData(t){if("product details"!==t.pageType)return;const e=this.parseProductDataSource();e&&(this.setProductId(t,e),this.setBasicProductInfo(t,e),this.setProductCategories(t,e),this.setProductCondition(t,e),this.setProductPricing(t,e),this.setProductMedia(t,e),this.setProductType(t,e),this.updateFinancingUrl(t))}parseProductDataSource(){return this.parseJsonElement("unit-analytics-data")}setProductId(t,e){t.isExternalBrandedZoneSite&&e.productExternalId?(t.productInfo.product_id=e.productExternalId,t.productInfo.product_external_platform=[t.parentSitePlatformType],t.productInfo.product_external_id=[e.productExternalId]):t.productInfo.product_id=e.productId}setBasicProductInfo(t,e){e.item&&(t.productInfo.product_name=e.item.trim()),e.itemModel&&(t.productInfo.product_model=e.itemModel),e.itemYear>0&&(t.productInfo.product_year=e.itemYear),e.itemIndustry&&(t.productInfo.product_industry=e.itemIndustry.trim()),t.productInfo.product_uri=window.location.pathname,t.productInfo.product_on_sale=e.itemOnSale?1:0,t.productInfo.vdp_urgency_active=this.getDOMElement(".visitors-count","visitorsCount")?1:0,utag_data.did_active=this.getDOMElement("#inventory_promoMessage","promoMessage")?1:0}setProductCategories(t,e){e.itemTypeId&&(t.productInfo.product_category=e.itemType,t.productInfo.product_category_id=e.itemTypeId),e.itemSubtypeId&&(t.productInfo.product_subcategory_id=e.itemSubtypeId,t.productInfo.product_subcategory=e.itemSubtype),e.itemMakeId&&(t.productInfo.product_make_id=e.itemMakeId,t.productInfo.product_make=e.itemMake)}setProductCondition(t,e){e.usageStatus?t.productInfo.product_condition=e.usageStatus.trim():e.isUnitInventory||(t.productInfo.product_condition="New")}setProductPricing(t,e){const o=t=>{const e=window.analyticsUtils.parsePrice(t);return e>0?e:null};if(e.itemOriginalPrice){const r=o(e.itemOriginalPrice);r&&(t.productInfo.product_original_price=r)}if(e.itemOnSale&&e.salePrice)t.productInfo.product_price=e.salePrice.toString().replace(/[$,]/g,""),e.discountAmount&&(t.productInfo.product_discount_amount=e.discountAmount);else if(e.itemOriginalPrice){const r=o(e.itemOriginalPrice);r&&(t.productInfo.product_price=r)}}setProductMedia(t,e){e.itemThumbNailUrl&&(t.productInfo.product_image_url=e.itemThumbNailUrl),t.productInfo.product_custom_image_count=e.itemCustomImageCount||0,t.productInfo.product_videos_count=e.itemVideoExists||0,t.productInfo.product_360view_count=this.getDOMElement("#dealer360-spin-container","spin360")?1:0,t.productInfo.product_description_char_count=e.itemDescriptionCount||0}setProductType(t,e){t.productInfo.product_type=e.isUnitInventory?"Inventory":"Showcase"}updateFinancingUrl(t){const e=$("a[data-form-type='financing'][data-is-external-url='False']");if(0!==e.length)try{const o=new URL(e.attr("href"),window.location.origin);o.searchParams.append("item_360view_count",t.productInfo.product_360view_count),o.searchParams.append("vdp_urgency_active_flag",t.productInfo.vdp_urgency_active),e.attr("href",o.toString())}catch(t){console.error("Error parsing financing URL in Tealium component:",t)}}getPromotionAnalyticsData(t){const e=this.parsePromotionDataSource();e&&(this.setPromotionBasicInfo(t,e),this.setPromotionMakeInfo(t,e),this.setPromotionCategoryInfo(t,e))}parsePromotionDataSource(){return this.parseJsonElement("promotion-analytics-data")}setPromotionBasicInfo(t,e){e.promotionId&&(t.brandPromotionInfo.promotion_id=e.promotionId,t.brandPromotionInfo.promotion_name=e.promotionName)}setPromotionMakeInfo(t,e){e.promotionMakeId&&(t.brandPromotionInfo.promotion_make_id=e.promotionMakeId,t.brandPromotionInfo.promotion_make=e.promotionMake)}setPromotionCategoryInfo(t,e){e.promotionCategoryId&&(t.brandPromotionInfo.promotion_category=e.promotionCategory,t.brandPromotionInfo.promotion_category_id=e.promotionCategoryId)}setProductItemsArrays(t,e,o,r){const a=this.initializeProductArrays(),i=this.extractProductItems(t);this.populateProductArrays(t,a,i),this.addArraysToUtag(e,a)}initializeProductArrays(){return{makes:[],years:[],ids:[],names:[],types:[],onSales:[],prices:[],categories:[],categoryIds:[],industries:[],makeIds:[],msrps:[],vins:[],externalColors:[],productExternalIds:[],productExternalPlatforms:[],activePromotions:[]}}extractProductItems(t){const e=[],o=ProductHandler.PRODUCT_FIELDS,r=this;return $("span.datasource.hidden").each(function(){try{const t=this.innerText||this.textContent;if(!t||""===t.trim())return void console.warn("Empty datasource element found:",this);const a=JSON.parse(t);r.isValidProductData(a,o)&&e.push(a)}catch(t){console.error("JSON parse failed for unit:",t,"Element:",this)}}),e}isValidProductData(t,e){return Object.entries(t).some(([t,o])=>e.includes(t)&&null!=o&&!/^\s*$/.test(String(o)))}populateProductArrays(t,e,o){o.forEach(o=>{e.makes.push(o.itemMake),e.years.push(o.itemYear),e.names.push(o.name),e.prices.push(o.unitPrice),e.categories.push(o.itemType),e.categoryIds.push(o.itemTypeId),e.industries.push(o.itemIndustry),e.makeIds.push(o.productOwnerId),e.msrps.push(o.itemOriginalPrice),e.vins.push(o.vin),e.externalColors.push(o.primaryColor),t.isExternalBrandedZoneSite&&o.productExternalId?(e.ids.push(parseInt(o.productExternalId)),e.productExternalIds.push(o.productExternalId),e.productExternalPlatforms.push(t.parentSitePlatformType)):e.ids.push(o.productId),e.types.push(this.getBooleanValue(o.isUnitInventory)?"Inventory":"Showcase"),e.onSales.push(this.getBooleanValue(o.itemOnSale)?"1":"0"),e.activePromotions.push(o.arePromotionsAvailable?1:0)})}getBooleanValue(t){return void 0!==t&&"TRUE"===String(t).toUpperCase()}addArraysToUtag(t,e){Object.entries(ProductHandler.UTAG_MAPPINGS).forEach(([o,r])=>{const a=e[r];a&&a.length>0&&(t[o]=a)})}parseProductsData(t,e){const o={};return this.setProductIdFromItem(t,e,o),this.setBasicProductInfoFromItem(e,o),this.setProductCategorizationFromItem(e,o),this.setProductPricingFromItem(e,o),this.setProductMediaFromItem(e,o),this.setProductFlagsFromItem(e,o),o}setProductIdFromItem(t,e,o){t.isExternalBrandedZoneSite&&e.productExternalId?o.product_id=e.productExternalId:e.productId&&(o.product_id=e.productId)}setBasicProductInfoFromItem(t,e){t.item&&(e.product_name=t.item),(t.itemModel||t.model)&&(e.product_model=t.itemModel||t.model),(t.itemYear>0||t.year>0)&&(e.product_year=t.itemYear>0?t.itemYear:t.year),t.itemMake&&(e.product_make=t.itemMake),t.itemMakeId&&(e.product_make_id=t.itemMakeId);const o=t.itemUrl||t.itemurl;o&&(e.product_uri=new URL(o,window.location).pathname),t.usageStatus&&(e.product_condition=t.usageStatus),e.product_type=t.isUnitInventory||"True"===t.isUnitInventory?"Inventory":"Showcase",t.itemIndustry&&(e.product_industry=t.itemIndustry)}setProductCategorizationFromItem(t,e){t.itemType&&(e.product_category=t.itemType),t.itemTypeId&&(e.product_category_id=t.itemTypeId),t.itemSubtype&&(e.product_subcategory=t.itemSubtype),t.itemSubtype&&t.itemSubtypeId&&(e.product_subcategory_id=t.itemSubtypeId)}setProductPricingFromItem(t,e){if(t.itemDisplayPrice){const o=this.parsePrice(t.itemDisplayPrice);o>0&&(e.product_price=o)}if(t.itemOriginalPrice){const o=this.parsePrice(t.itemOriginalPrice);o>0&&(e.product_original_price=o)}if(t.itemOnSale?e.product_on_sale="TRUE"===t.itemOnSale.toUpperCase()?"1":"0":1461!==t.FormId&&(e.product_on_sale="0"),e.product_price&&e.product_original_price){const t=e.product_original_price-e.product_price;t>0&&(e.product_discount_amount=t)}}setProductMediaFromItem(t,e){void 0!==t.itemCustomImageCount?e.product_custom_image_count=t.itemCustomImageCount:t.imageCount>=0&&(e.product_custom_image_count=t.imageCount),void 0!==t.itemVideoExists?e.product_videos_count=t.itemVideoExists:t.videoCount>=0&&(e.product_videos_count=t.videoCount),void 0!==t.itemDescriptionCount?e.product_description_char_count=t.itemDescriptionCount:t.descriptionLength>=0&&(e.product_description_char_count=t.descriptionLength)}setProductFlagsFromItem(t,e){t.item_360view_count&&(e.product_360view_count=t.item_360view_count),t.vdp_urgency_active_flag&&(e.vdp_urgency_active=t.vdp_urgency_active_flag)}parsePrice(t){return window.analyticsUtils.parsePrice(t)}getShowCaseData(t){var e={};return t.page_make&&(e.page_make=t.page_make.toLowerCase()),t.page_make_id&&(e.page_make_id=t.page_make_id),t.page_category&&(e.page_category=t.page_category),t.page_category_id&&(e.page_category_id=t.page_category_id),t.page_subcategory&&(e.page_subcategory=t.page_subcategory),t.page_subcategory_id&&(e.page_subcategory_id=t.page_subcategory_id),e}getPromotionData(t,e){var o={};return localStorage&&localStorage.selectedPromotionIds&&(o.did_promotions_selected=localStorage.selectedPromotionIds,o.campaign_id=localStorage.selectedPromotionIds),t&&(o.did_form_id=t.formId,o.did_form_name=t.formName,o.did_form_submission_first_name=t.form_submission_first_name,o.did_form_submission_last_name=t.form_submission_last_name),e&&e.contact&&(o.did_form_submission_perferred_contact=e.contact,"email"===e.contact&&(o.did_form_submission_email=e.email),"phone"===e.contact&&(o.did_form_submission_phone=e.phone)),o}getProductsDataFromQueryString(){try{if(window.location.search&&window.analyticsUtils)return window.analyticsUtils.QueryStringToJSON()||{}}catch(t){console.warn("Failed to parse query string for product data:",t)}return{}}}class EventHandler{constructor(){this.initialized=!1}triggerUtagLink(t){window.analyticsUtils.triggerUtagLink({},null,t)}triggerUtagTrack(t,e){window.analyticsUtils.triggerUtagTrack(t,e)}initialize(t,e){if(this.initialized)return;const o=[{selector:".location-directions",handler:t=>{e.tealium_event="google_map_click",this.triggerUtagLink({tealium_event:"google_map_click"})}},{selector:".click-promotion-details",handler:(t,o)=>{var r=o.querySelector("script");if(r)try{var a=JSON.parse(r.innerHTML);e.promotion_id=a.id,e.promotion_name=a.name,e.promotion_creative=a.creative,e.promotion_category=a.category,e.promotion_position=a.position,e.promotion_discount=a.discount,e.promotion_discount_type=a.discount_type,e.promotion_start_date=a.start_date,e.promotion_end_date=a.end_date,e.promotion_disclaimer=a.disclaimer,e.promotion_external_url=a.external_url,e.promotion_internal_url=a.internal_url}catch(t){console.log("Error parsing promotion details JSON",t)}e.site_section="promo",e.site_sub_section="promo_detail",e.tealium_event="promo_click",this.triggerUtagLink(e)}},{selector:'[class*="component OfferRotator_"]',handler:(t,o)=>{var r=o.querySelector('div[class*="slide slick-slide slick-current"]'),a="",i=[],n="";r&&(a=r.getAttribute("data-slick-index"),(i=r.querySelectorAll("img")).length>0&&(n=i[0].getAttribute("alt")));var s={tealium_event:"carousel_click"};s.carousel_asset_name=n,s.carousel_asset_index=a,s.site_sub_section="home",s=$.extend({},e,s),this.triggerUtagLink(s)}}];document.addEventListener("mousedown",t=>{o.forEach(({selector:e,handler:o})=>{const r=t.target.closest(e);r&&o(t,r)})}),$(document).on("click","[id^=addToCartECommerce]",function(){const t=$(this).attr("id").split("-").pop(),e={tealium_event:"ecommerce_part_cart_action",product_id:$(`#product-id-${t}`).val(),product_name:$(`#product-name-${t}`).val(),product_brand:$(`#product-brand-${t}`).val(),product_category:$(`#product-category-${t}`).val(),product_variant:$(`#product-variant-${t}`).val(),product_list_name:$(`#product-list-name-${t}`).val(),product_list_id:$(`#product-list-id-${t}`).val(),product_position:$(`#product-position-${t}`).val(),product_quantity:parseInt($(`#product-quantity-${t}`).val())||1,product_price:window.analyticsUtils.parsePrice($(`#product-price-${t}`).val())||0,product_discount:window.analyticsUtils.parsePrice($(`#product-discount-${t}`).val())||0,product_coupon:$(`#product-coupon-${t}`).val(),ecomm_part_detail_inventory_class:"Part",order_id:"",order_total:0,order_currency:"USD"};this.triggerUtagTrack("addtocart",e),window.analyticsUtils.triggerUtagLink(e,"ecommerce_part_cart_action")}.bind(this)),this.setupEcommerceCartModificationListener(),this.setupEcommerceEventHandlers(),window.addEventListener("load",()=>{this.initializeBRPEvents(t,e)}),this.initialized=!0}initializeBRPEvents(t,e){const o="oem_brp_branded_zone_click";function r(t,o,r,a="",i="",n="",s="",c="",d="",l="",u="",m=""){t.preventDefault();const _=t.target.closest("a")?.getAttribute("href")||"",p=void 0!==e?{...e,tealium_event:o,oem_brp_branded_zone_action:r,...a&&{oem_brp_branded_zone_model:a},...i&&{oem_brp_branded_zone_condition:i},...n&&{oem_brp_branded_zone_promotion:n},...s&&{oem_brp_branded_zone_destination:s},...c&&{related_product_name:c},...d&&{related_product_id:d},...l&&{oem_brp_branded_zone_productline:l},...u&&{oem_brp_branded_zone_hotspot_title:u},...m&&{oem_brp_branded_zone_hotspot_section:m}}:null;console.log("Updated data to send:",p);const g=()=>{_&&(_.startsWith("http")?window.open(_,"_blank"):window.location.href=_)};p&&"undefined"!=typeof utag&&"function"==typeof utag.link?utag.link(p,null,[function(){g()}]):g()}function a(t){const e=t?.querySelector(".brp-lineup__unit-info .brp-lineup__unit-info-heading");if(!e)return"";const o=e.textContent.trim(),r=o.split(" ");return r.length>1?r.slice(1).join(" ").toLowerCase():o.toLowerCase()}function i(){const t=document.querySelector(".brp-accessories__type-item.active"),e=t?.querySelector("a"),o=e?.textContent;return o?o.toLowerCase():""}function n(){const t=document.querySelector(".brp-accessories__modal-title");return t?t.textContent.trim().toLowerCase():""}function s(){const t=document.querySelector(".brp-accessories__heading");return t?t.textContent.trim().toLowerCase():""}function c(){const t=document.getElementById("accessories"),e=document.querySelector(".brp-accessories__type-item.active a"),o=e?.getAttribute("href")?.substring(1),r=o?document.getElementById(o):null,a=r?.querySelector(".brp-accessories__hotspots-figure img"),i=a?.getAttribute("alt")||"";if(!i)return"";const n=i.split(" "),s={"can-am":t=>t.slice(1).join(" ").toLowerCase(),"sea-doo":t=>t.join(" ").toLowerCase()},c=Object.keys(s).find(e=>t?.classList.contains(e));return c&&s[c]?s[c](n):""}const d=[{selector:".brp-promotions__btn--offer",handler:t=>r(t,o,"click_to_promo","","","promotion banner")},{selector:".brp-lineup__unit-item",handler:t=>{const e=t.target.closest(".brp-lineup__unit-item")?.querySelector(".brp-lineup__unit-nav-title");r(t,o,"click_on_model",e?.textContent.trim().toLowerCase()||"")}},{selector:".brp-header__button div a",handler:t=>r(t,o,"click_on_view_inventory")},{selector:".logos__dealer",handler:t=>r(t,o,"click_on_dealer_logo")},{selector:".brand__dropdown .dropdown__logo:not(.dropdown__logo--del)",handler:t=>{const e=t.target.closest(".dropdown__logo")?.querySelector("img");r(t,o,"click_on_brand","","","",e?.getAttribute("alt")||"")}},{selector:".brp-heroshot .brp-heroshot__cta-buttons a:nth-child(2)",handler:t=>r(t,o,"click_on_secondary_cta")},{selector:".brp-lineup__unit-inventory-all",handler:t=>{const e=t.target.closest(".tab-pane");r(t,o,"click_on_view_model_inventory",a(e))}},{selector:".brp-inventory-item__cta-actions .brp-inventory-item__btn--primary",handler:t=>{const e=t.target.closest(".brp-inventory-item"),i=t.target.closest(".tab-pane");r(t,o,"click_on_view_details",a(i),function(t){const e=t?.querySelector(".brp-inventory-item__data-usage");return e?e.textContent.trim():""}(e))}},{selector:".related_products_carousel .slick-track .related-product",handler:t=>{const e=t.target.closest(".related-product"),a=e?.querySelector(".product-title a"),i=a?a.textContent.trim():"",n=a?a.getAttribute("href"):"",s=n?n.match(/-(\d+)[^\\d]*$/):null,c=s?s[1]:"";r(t,o,"related_products_click","","","","",i,c)}},{selector:".brp-accessories__hotspots-actions .brp-accessories__hotspot-btn",handler:t=>{r(t,o,"opening_hotspot",c(),"","","","","",i(),n(),s())}},{selector:".brp-accessories__modal.modal .close",handler:t=>{r(t,o,"closing_hotspot",c(),"","","","","",i(),n(),s())}},{selector:".brp-accessories__modal.modal .brp-accessories__modal-btn",handler:t=>{r(t,o,"hotspot_cta","","","","","","","",n())}},{selector:".brp-accessories__type-item .brp-accessories__type-nav",handler:t=>{r(t,o,"accessories_line_selector",c(),"","","","","",i())}},{selector:".brp-lineup__type-item .brp-lineup__type-nav",handler:t=>{r(t,o,"vehicle_line_selector","","","","","","",function(){const t=document.querySelector(".brp-lineup__type-item.active"),e=t?.querySelector("a"),o=e?.textContent;return o?o.toLowerCase():""}())}}];document.addEventListener("click",t=>{d.forEach(({selector:e,handler:o})=>{const r=t.target.closest(e);r&&o(t,r)})})}setupEcommerceCartModificationListener(){$(document).on("ecommerce_part_modify_cart",t=>{this.executeWithErrorHandling(()=>{t.data&&"ecommerce_part_modify_cart"===t.data.tealium_event&&!("ecomm_part_detail_inventory_class"in t.data)&&(t.data.ecomm_part_detail_inventory_class="Part")},"Error processing eCommerce cart modification event")})}setupEcommerceEventHandlers(){$(document).on("ecommerce_part_cart_action",t=>{this.executeWithErrorHandling(()=>{t.data&&"ecommerce_part_cart_action"===t.data.tealium_event&&("ecomm_part_detail_inventory_class"in t.data||(t.data.ecomm_part_detail_inventory_class="Part"),window.analyticsUtils.triggerUtagLink(t.data,"ecommerce_part_cart_action"))},"Error processing eCommerce cart action event")}),$(document).on("ecommerce_part_modify_cart",t=>{this.executeWithErrorHandling(()=>{t.data&&"ecommerce_part_modify_cart"===t.data.tealium_event&&("ecomm_part_detail_inventory_class"in t.data||(t.data.ecomm_part_detail_inventory_class="Part"),window.analyticsUtils.triggerUtagLink(t.data,"ecommerce_part_modify_cart"))},"Error processing eCommerce part modification event")})}executeWithErrorHandling(t,e){try{return t()}catch(t){return console.error(e,t),null}}}class FormHandler{constructor(){this.initialized=!1,this.interactionTracked=new Set,this.formSubmissionTracked=new Set,this.formLoadTracked=new Set,this.formTrackingSetup=!1,this.trackingCallback=null}initialize(t,e){if(this.initialized)return;const o=this;$("body").on("show.bs.modal",'div[id*="AriFormModal"]',function(r){var a={tealium_event:"form_load"},i=r.currentTarget.closest(".ari-form"),n=i.id;if(a.form_name=$(i).find("span[data-form-name]").attr("data-form-name"),a.form_type=$(i).find("span[data-lead-type]").attr("data-lead-type"),a.form_id=$(i).find("span[data-form-id]").attr("data-form-id"),"Get Promotions"===a.form_name&&(a.tealium_event="did_view_offer_details_click",localStorage&&(a.did_promotions_name=localStorage.selectedPromotionTitle,a.campaign_id=localStorage.selectedPromotionIds)),a.form_id&&a.form_type&&a.form_name){const r=o.extractFormProductData(i);var s=$.extend({},t.siteUser,a,r,t.productInfo);e.page_h1&&(s.page_h1=e.page_h1),s.product_make&&(s.page_make=s.product_make.toLowerCase()),s.product_make_id&&(s.page_make_id=s.product_make_id),t.pageMakeGroup&&(s.page_make_group=t.pageMakeGroup),window.analyticsUtils.triggerUtagLink(s,s.tealium_event),o.formInteraction(s,n)}}),document.addEventListener("searchModalOpen",o=>{var r={tealium_event:"form_load"},a={},i=o.detail,n="";if(i&&(window.productHandler&&"function"==typeof window.productHandler.parseProductsData&&(a=window.productHandler.parseProductsData(t,i)),r.form_name=i.formName,r.form_type=i.formType,r.form_id=i.formId,n=t.isExternalBrandedZoneSite&&i.productId?`${i.modelName}_${i.productId}`:`${i.modelName}_${a.product_id||""}`,r.form_id&&r.form_type&&r.form_name)){var s=Object.assign({},t.siteUser,r,a);e&&e.page_h1&&(s.page_h1=e.page_h1),t.pageMakeGroup&&(s.page_make_group=t.pageMakeGroup),this.trackEvent("form_load",s),this.formInteraction(s,n)}}),this.initialized=!0}setTrackingCallback(t){this.trackingCallback=t}setupFormTracking(){this.formTrackingSetup?console.log("Form tracking already set up, skipping..."):(this.formTrackingSetup=!0,this.trackStaticFormLoads())}trackStaticFormLoads(){const t=window.utag_data?.page_type||"other";if(console.log(`ðŸ” Page type: ${t} - Checking if static form loads should be tracked`),"search"===t||"product details"===t)return void console.log(`â­ï¸ Skipping static form loads on ${t} page - forms will only trigger when modals are opened`);console.log(`âœ… Processing static form loads for ${t} page (matches old template behavior)`);const e=document.querySelectorAll('.component[class*=" LeadForm_"]');console.log(`ðŸ” trackStaticFormLoads called for ${t} page - Found ${e.length} LeadForm components`),e.forEach(t=>{const e=t.querySelector("span[data-form-id]")?.getAttribute("data-form-id")||"unknown",o=t.querySelector("span[data-form-name]")?.getAttribute("data-form-name")||"unknown",r=`${e}_${o}_${t.outerHTML.length}`;this.formLoadTracked.has(r)?console.log(`â­ï¸ Skipping already tracked form: ${o} (ID: ${e})`):t.closest('div[class*="Staff_"]')?console.log(`â­ï¸ Skipping Staff form: ${o} (ID: ${e})`):t.closest('div[class*="OfferedServices_"]')?console.log(`â­ï¸ Skipping OfferedServices form: ${o} (ID: ${e})`):t.closest('div[class*="ShowcaseRoot_"]')?console.log(`â­ï¸ Skipping ShowcaseRoot form: ${o} (ID: ${e})`):t.closest('div[class*="VDP-Unit-Detail_"]')?console.log(`â­ï¸ Skipping VDP-Unit-Detail form: ${o} (ID: ${e})`):t.closest('div[class*="SearchRoot_"]')?console.log(`â­ï¸ Skipping SearchRoot form: ${o} (ID: ${e})`):1461==e&&screen.width>=768?console.log(`â­ï¸ Skipping Can't Find form (desktop): ${o} (ID: ${e})`):(this.formLoadTracked.add(r),console.log(`ðŸ” Processing static form_load for: ${o} (ID: ${e}) - Key: ${r}`),this.processFormLoad(t))})}processFormLoad(t){const e=this.extractFormData(t),o=this.extractFormProductData(t),r=Object.assign({},e,o);if(this.isValidForm(r)){this.trackEvent("form_load",r);const e=t.querySelector(".ari-form");let o=e?e.id:null;o||(o=`form_${r.form_id}_${r.form_name.replace(/\s+/g,"_")}`),this.formInteraction(r,o)}}extractFormProductData(t){if("finance"===(window.utag_data?.page_type||"other"))return window.productHandler?.getProductsDataFromQueryString()||{};{const e=t.querySelector(".datasource.hidden");if(e&&e.innerHTML)try{const t=JSON.parse(e.innerHTML);if(t&&t.productId&&window.productHandler)return window.productHandler.parseProductsData(window.TealiumConfig||{},t)}catch(t){console.warn("Failed to parse form datasource:",t)}}return{}}extractFormData(t){const e=t.querySelector("span[data-form-name]"),o=t.querySelector("span[data-lead-type]"),r=t.querySelector("span[data-form-id]"),a=t.querySelector("span[data-form-location]");return{form_name:e?.getAttribute("data-form-name")||"",form_type:o?.getAttribute("data-lead-type")||"",form_id:r?.getAttribute("data-form-id")||"",form_location:a?.getAttribute("data-form-location")||"",form_element:t}}isValidForm(t){return t.form_name&&(t.form_type||t.form_id)}setupFormInteraction(t,e){const o=this.getFormKey(e);if(this.interactionTracked.has(o))return;let r=t.closest(".ari-form")||t.closest('[id*="AriFormModal"]')||t.closest('[class*="Modal"]')||t.closest('[class*="modal"]')||t.closest("form");if(!r){let e=t.parentElement;for(;e&&e!==document.body;){if(e.id){r=e;break}e=e.parentElement}}const a=r?r.id:null;if(!a)return console.warn("Could not find form modal ID for interaction tracking, falling back to direct form interaction"),void this.setupDirectFormInteraction(t,e,o);$(`#${a}`).on("click","input,select,textarea,label",t=>{if(!this.interactionTracked.has(o)){this.interactionTracked.add(o);const t={...e,tealium_event:"form_interaction"};this.trackEvent("form_interaction",t),$(`#${a}`).off("click","input,select,textarea,label")}})}setupDirectFormInteraction(t,e,o){const r=a=>{if(!this.interactionTracked.has(o)){this.interactionTracked.add(o);const a={...e,tealium_event:"form_interaction"};this.trackEvent("form_interaction",a),t.removeEventListener("input",r),t.removeEventListener("focus",r),t.removeEventListener("click",r)}};t.querySelectorAll("input,select,textarea,label").forEach(t=>{t.addEventListener("input",r),t.addEventListener("focus",r),t.addEventListener("click",r)})}formInteraction(t,e,o=""){console.log("formInteraction called with:",{final:t,formDetail:e});const r=document.querySelector("#"+e+" form"+o);if(r){console.log("Form with ID found, attaching event listeners.");const e=this.getFormKey(t),o=()=>{if(!this.interactionTracked.has(e)){console.log("Tracking form interaction for:",e),this.interactionTracked.add(e);var a=Object.assign({},t);a.tealium_event="form_interaction","undefined"!=typeof utag?utag.link(a):console.log("Could not trigger utag.link method for form interaction."),r.removeEventListener("input",o),r.removeEventListener("focus",o),r.removeEventListener("click",o)}};r.addEventListener("input",o),r.addEventListener("focus",o),r.addEventListener("click",o)}else console.log(`Form with ID ${e} not found.`)}setupFormSubmissionListener(){document.addEventListener("submit",t=>{const e=t.target,o=e.closest('.component[class*=" LeadForm_"]');o&&this.handleFormSubmission(e,o)})}handleFormSubmission(t,e){const o=this.extractFormData(e),r=this.getFormKey(o);if(this.formSubmissionTracked.has(r))return;this.formSubmissionTracked.add(r);const a=this.extractFormFieldData(t),i={...o,...a};this.trackEvent("form_submission",i)}extractFormFieldData(t){const e={},o=new FormData(t),r={firstName:"customer_first_name",lastName:"customer_last_name",email:"customer_email",phone:"customer_phone",zipCode:"customer_zip_code",city:"customer_city",state:"customer_state",message:"customer_message",interest:"customer_interest"};for(const[t,a]of o.entries()){const o=r[t]||t;a&&a.toString().trim()&&(e[o]=a.toString().trim())}return e}setupFormInteractionTracking(){this.setupServiceFormTracking(),this.setupFinancingFormTracking(),this.setupTradeInFormTracking()}setupServiceFormTracking(){document.querySelectorAll('.component[class*="ServiceForm"]').forEach(t=>{const e=t.querySelector('select[name*="serviceType"]');e&&e.addEventListener("change",t=>{this.trackEvent("service_type_selected",{service_type:t.target.value,form_type:"service"})})})}setupFinancingFormTracking(){document.querySelectorAll('.component[class*="FinancingForm"]').forEach(t=>{const e=t.querySelector('select[name*="creditScore"]');e&&e.addEventListener("change",t=>{this.trackEvent("credit_score_selected",{credit_score:t.target.value,form_type:"financing"})})})}setupTradeInFormTracking(){document.querySelectorAll('.component[class*="TradeInForm"]').forEach(t=>{const e=t.querySelector('select[name*="vehicleType"]');e&&e.addEventListener("change",t=>{this.trackEvent("trade_vehicle_type_selected",{vehicle_type:t.target.value,form_type:"trade_in"})})})}setupDIDPromotionFormHandler(){document.querySelectorAll(".did-promotion-form").forEach(t=>{t.addEventListener("submit",e=>{this.handleDIDFormSubmission(e,t)})}),document.addEventListener("click",t=>{t.target.matches(".did-promotion-toggle")&&this.handleDIDFormToggle(t)})}handleDIDFormSubmission(t,e){const o=this.extractDIDPromotionData(e);this.trackEvent("did_promotion_form_submission",o)}handleDIDFormToggle(t){const e="false"===t.target.getAttribute("aria-expanded"),o=t.target.getAttribute("data-promotion-id");this.trackEvent(e?"did_promotion_expanded":"did_promotion_collapsed",{promotion_id:o,action:e?"expand":"collapse"})}extractDIDPromotionData(t){return{promotion_id:t.getAttribute("data-promotion-id")||"",promotion_name:t.getAttribute("data-promotion-name")||"",promotion_type:"did",dealer_id:t.getAttribute("data-dealer-id")||""}}getFormKey(t){return`${t.form_name}_${t.form_type}_${t.form_id}`}trackEvent(t,e={}){this.trackingCallback?this.trackingCallback(t,e):console.warn("No tracking callback set for form event:",t)}trackCustomFormEvent(t,e,o={}){const r={...this.extractFormData(t),...o};this.trackEvent(e,r)}resetFormTracking(t){const e=this.extractFormData(t),o=this.getFormKey(e);this.interactionTracked.delete(o),this.formSubmissionTracked.delete(o)}getFormAnalytics(){return{formsWithInteraction:this.interactionTracked.size,formsSubmitted:this.formSubmissionTracked.size,totalFormsTracked:document.querySelectorAll('.component[class*=" LeadForm_"]').length}}TriggerOfferedServicesFormLoad(t){this.executeWithErrorHandling(()=>{const e=document.querySelector(`#${t} .ari-form`);e&&this.TriggerUtagFormLoad(e)},`Could not trigger offered services form load for ${t}`)}TriggerUtagFormLoad(t){this.executeWithErrorHandling(()=>{var e={tealium_event:"form_load"},o=$(t);o.closest('div[class*="Staff_"]').length>0&&(e.form_context="staff"),o.closest('div[class*="OfferedServices_"]').length>0&&(e.form_context="offered_services"),o.closest('div[class*="ShowcaseRoot_"]').length>0&&(e.form_context="showcase"),o.closest('div[class*="VDP-Unit-Detail_"]').length>0&&(e.form_context="vdp_unit_detail"),o.closest('div[class*="SearchRoot_"]').length>0&&(e.form_context="search"),e.form_name=o.find("span[data-form-name]").attr("data-form-name"),e.form_type=o.find("span[data-lead-type]").attr("data-lead-type"),e.form_id=o.find("span[data-form-id]").attr("data-form-id");var r=o.find(".ari-form").attr("id");if(e.form_id&&e.form_type&&e.form_name){var a=Object.assign({},this.config?.siteUser||{},e);window.utag_data&&window.utag_data.page_h1&&(a.page_h1=window.utag_data.page_h1),this.trackEvent("form_load",a),r&&this.formInteraction(a,r)}},"Could not trigger utag.link method")}setupFormSubmissionTracking(){document.addEventListener("submit",t=>{const e=t.target,o=e.closest('.component[class*=" LeadForm_"]');o&&this.handleFormSubmission(e,o)}),document.addEventListener("FormSubmissionDetails",t=>{this.executeWithErrorHandling(()=>{let e={};if(t.detail?e=t.detail:t.detail.formData&&(e=t.detail.formData),e){const t={tealium_event:"form_submit",...e};"Get A Quote"===t.form_name&&(t.tealium_event="did_get_a_quote_form_submit"),this.trackEvent(t.tealium_event,t)}},"Could not process form submission details event")})}executeWithErrorHandling(t,e){try{return t()}catch(t){return console.error(e,t),null}}destroy(){this.interactionTracked.clear(),this.formSubmissionTracked.clear(),this.formLoadTracked.clear(),this.formTrackingSetup=!1,this.isInitialized=!1}}class PageHandlers{constructor(){this.initialized=!1}handlePageSpecificLogic(t,e){const{pageType:o,pageSubType:r}=t;if("search"===o){window.productHandler.setProductItemsArrays(t,e);var a=$('[class*="component SearchRoot_"] .seo-banner');if(0==a.length&&(a=$('[class*="component SEO-Content_"] .seo-banner')),a.length>0){var i=a[0].innerHTML.match(/href=(\"(.*?)\")/g);i&&(e.product_list_header_buttons_uris=i);var n=a[0].querySelectorAll("p,li");n.length>0&&(e.product_list_header_p_char_counts=window.analyticsUtils.countTextCharacters(n)),e.product_list_header_img_count=a[0].getElementsByTagName("img").length}var s=$('[class*="component SearchRoot_"] .seo-footer');if(0==s.length&&(s=$('[class*="component SEO-Content_"] .seo-footer')),s.length>0){var c=s[0].getElementsByTagName("h2"),d=s[0].getElementsByTagName("h3"),l=s[0].querySelectorAll("p,li");if(l.length>0){const t=window.analyticsUtils.extractTextData(l);e.product_list_footer_p_char_counts=t.lengths}if(e.product_list_footer_img_count=s[0].getElementsByTagName("img").length,c.length>0){const t=window.analyticsUtils.extractTextData(c);e.product_list_footer_h2_char_counts=t.lengths,e.product_list_footer_h2_strings=t.texts}if(d.length>0){const t=window.analyticsUtils.extractTextData(d);e.product_list_footer_h3_char_counts=t.lengths,e.product_list_footer_h3_strings=t.texts}}var u=$(".search-results-count");if(u.length>0){var m=u[0].innerText.split(" ");e.search_result_count=m[m.length-2]}e.did_active=window.analyticsUtils.getCachedElements(".promotion-link","promotionLinks").length>0?1:0}else"showroom"==o&&(window.analyticsUtils.setDataPointByDataPropertyName(e,"data-product-owner-name","page_make"),window.analyticsUtils.setDataPointByDataPropertyName(e,"data-product-owner-id","page_make_id"),window.analyticsUtils.setDataPointByDataPropertyName(e,"data-category","page_category"),window.analyticsUtils.setDataPointByDataPropertyName(e,"data-category-id","page_category_id"),window.analyticsUtils.setDataPointByDataPropertyName(e,"data-selected-sub-category","page_subcategory"),window.analyticsUtils.setDataPointByDataPropertyName(e,"data-selected-sub-category-id","page_subcategory_id"));if("blog post"===r){var _=$(".blog-detail__header-detail-author span").text().trim();_&&(e.blog_article_author=_);var p=$(".blog-detail__header-detail-category span").text().trim();p&&(e.blog_article_category=p);var g=$(".blog-detail__header-detail-date span").text().trim();if(g&&g.length>0){var h=new Date(g);e.blog_article_date=("0"+(h.getMonth()+1)).slice(-2)+"/"+("0"+h.getDate()).slice(-2)+"/"+h.getFullYear()}var f=$(".blog-detail h2");if(f.length>0){e.blog_article_h2_char_counts=[],e.blog_article_h2_strings=[];for(var y=0;y<f.length;y++)e.blog_article_h2_char_counts.push(f[y].innerText.length.toString()),e.blog_article_h2_strings.push(f[y].innerText.trim())}var v=$(".blog-detail p, .blog-detail li");if(v.length>0){e.blog_article_p_char_counts=[];for(y=0;y<v.length;y++){var w=v[y].innerText.trim();w.length>0&&e.blog_article_p_char_counts.push(w.length.toString())}}var b=$(".blog-detail__tag-item");if(b.length>0){e.blog_article_tags=[];for(y=0;y<b.length;y++)e.blog_article_tags.push(b[y].innerText.trim())}}else if("blog list"===r){var k=$(".blog-list__blog-category");if(k.length>0){e.blog_list_articles_category=[];for(y=0;y<k.length;y++)e.blog_list_articles_category.push(k[y].innerText.trim())}var I=$(".blog-list__blog-header-detail-date");if(I.length>0){e.blog_list_articles_date=[];for(y=0;y<I.length;y++){h=new Date(I[y].innerText.trim());e.blog_list_articles_date.push(("0"+(h.getMonth()+1)).slice(-2)+"/"+("0"+h.getDate()).slice(-2)+"/"+h.getFullYear())}}var S=$(".blog-list__blog-title a");if(S.length>0){e.blog_list_articles_titles_char_counts=[],e.blog_list_articles_titles_strings=[];for(y=0;y<S.length;y++)e.blog_list_articles_titles_char_counts.push(S[y].innerText.trim().length.toString()),e.blog_list_articles_titles_strings.push(S[y].innerText.trim())}}}}class AnalyticsManager{constructor(){this.initialized=!1,this.utag_data={},this.config=null,this.domCache={}}executeWithErrorHandling(t,e){try{return t()}catch(t){console.error(e,t.message)}}getCachedElement(t,e){return $(window.analyticsUtils.getCachedElement(t,e))}triggerUtagView(t={}){window.analyticsUtils.triggerUtagView(this.utag_data,t)}triggerUtagLink(t,e={}){window.analyticsUtils.triggerUtagLink(this.utag_data,t,e)}initialize(t){return console.log("Initializing Tealium Analytics Manager"),this.config=t,this.processConfiguration(),window.utag_data=this.utag_data,this.initialized=!0,this.initializePageHandlers(),this}processConfiguration(){this.utag_data=Object.assign({},this.config.siteUser),this.addPageDataToUtag(),this.addSearchDataToUtag()}addPageDataToUtag(){const t=this.config;t.pageType&&(this.utag_data.page_type=t.pageType),t.pageSubType&&(this.utag_data.page_sub_type=t.pageSubType),t.pageBrand&&(this.utag_data.page_make=t.pageBrand),t.pageBrandId&&(this.utag_data.page_make_id=t.pageBrandId),t.pageBrandCategory&&(this.utag_data.page_category=t.pageBrandCategory),t.pageBrandCategoryId&&(this.utag_data.page_category_id=t.pageBrandCategoryId),t.pageBrandSubCategory&&(this.utag_data.page_sub_category=t.pageBrandSubCategory),t.pageBrandSubCategoryId&&(this.utag_data.page_sub_category_id=t.pageBrandSubCategoryId),t.pageMakeGroup&&(this.utag_data.page_make_group=t.pageMakeGroup)}addSearchDataToUtag(){const t=this.config;"search"===t.pageType&&this.processSearchFilters(),t.searchKeyword&&(this.utag_data.search_keyword=t.searchKeyword),t.searchPageAppliedFilters&&t.searchPageAppliedFilters.length>0&&(this.utag_data.search_filters=t.searchPageAppliedFilters)}processSearchFilters(){const t=decodeURI(window.location.href),e=t.indexOf("/inventory/");if(-1!==e){const o=t.substring(e+11).split("/"),r={};for(let t=0;t<o.length-1;t+=2){const e=o[t],a=o[t+1];e&&a&&(r[e]=r[e]||[]).push(a)}this.config.searchPageAppliedFilters=[],Object.keys(r).forEach(t=>{"query"===t?this.config.searchKeyword=r[t]:this.config.searchPageAppliedFilters.push(t+":"+r[t].join(","))})}}initializePageHandlers(){$(document).ready(()=>{this.handleDocumentReady()}),$(window).load(()=>{this.handleWindowLoad()})}handleDocumentReady(){this.executeWithErrorHandling(()=>{window.productHandler&&(window.productHandler.getProductAnalyticsData(this.config),this.utag_data=$.extend({},this.utag_data,this.config.productInfo))},"Error processing product analytics:"),this.executeWithErrorHandling(()=>{window.productHandler&&(window.productHandler.getPromotionAnalyticsData(this.config),this.utag_data=$.extend({},this.utag_data,this.config.brandPromotionInfo))},"Error processing promotion analytics:"),this.utag_data.podium_chatbox_active=0!=this.getCachedElement("div[class*='Premium-Texting_']","podiumChatbox").length?1:0,this.getCachedElement("#pageNotFoundModal","pageNotFoundModal").length&&(this.utag_data.tealium_event="error_view",this.utag_data.site_section="error",this.utag_data.site_sub_section="error",this.utag_data.page_error_code="404"),window.eventHandler&&window.eventHandler.initialize(this.config,this.utag_data);var t=this.getCachedElement("h1","h1Elements");t.length>0&&(this.utag_data.page_h1=t[0].innerText),window.pageHandlers&&window.pageHandlers.handlePageSpecificLogic(this.config,this.utag_data),this.executeWithErrorHandling(()=>{this.config.loadTealiumScript()},"Could not load tealium script."),window.formHandler&&window.formHandler.initialize(this.config,this.utag_data),this.getCachedElement('[class*="New-Holland-CE-Dealer-Landing-Page"]',"newHollandCE").length>0&&(this.utag_data.tealium_event="oem_standard_branded_zone_view",this.utag_data.page_make="new holland construction",this.utag_data.page_make_group="new holland construction"),this.setupCustomEventListeners()}setupCustomEventListeners(){document.addEventListener("DIDViewOfferDetailsClick",t=>{this.executeWithErrorHandling(()=>{var e={tealium_event:"did_view_offer_details_click"};t.detail&&(e.did_promotions_name=t.detail.promotionName,e.campaign_id=t.detail.promotionId);var o=Object.assign({},this.config.siteUser,e);window.analyticsUtils.triggerUtagLink(o,"did_view_offer_details_click")},"Could not trigger utag.link on promotion "+(t.detail?.promotionId||""))}),document.addEventListener("DIDViewMoreClick",t=>{this.executeWithErrorHandling(()=>{var e={tealium_event:"did_view_more_click"};t.detail&&(e.did_promotions_name=t.detail.promotionName,e.campaign_id=t.detail.promotionId);var o=Object.assign({},this.config.siteUser,e);window.analyticsUtils.triggerUtagLink(o,"did_view_more_click")},"Could not trigger utag.link on promotion "+(t.detail?.promotionId||""))}),document.addEventListener("FormSubmissionDetails",t=>{this.executeWithErrorHandling(()=>{var e={tealium_event:"form_submit"};t.detail?e=Object.assign({},e,t.detail):t.detail.formData&&(e=Object.assign({},e,t.detail.formData)),"Get A Quote"===e.form_name&&(e.tealium_event="did_get_a_quote_form_submit");const o=this.utag_data?.page_type||"other";let r={};"search"===o?t.detail?r=window.productHandler.parseProductsData(this.config,t.detail)||{}:t.detail.formData&&(r=window.productHandler.parseProductsData(this.config,t.detail.formData)||{}):"finance"===o?window.productHandler&&window.productHandler.getProductsDataFromQueryString&&(r=window.productHandler.getProductsDataFromQueryString()||{}):r=this.config.productInfo||{};const a=window.productHandler?.getShowCaseData?.(this.utag_data)||{},i=window.productHandler?.getPromotionData?.(e,t.detail?.formData)||{};var n=Object.assign({},this.config.siteUser,e,r,a,i);this.utag_data.page_h1&&(n.page_h1=this.utag_data.page_h1),r.product_make&&(n.page_make=r.product_make.toLowerCase()),r.product_make_id&&(n.page_make_id=r.product_make_id),this.config.pageMakeGroup&&(n.page_make_group=this.config.pageMakeGroup),window.analyticsUtils.triggerUtagLink(n,e.tealium_event)},"Could not trigger utag.link method for form submission")}),this.setupInventoryPromoHandler(),this.setupEcommerceEventListeners()}setupInventoryPromoHandler(){const t="limitedTimeOfferBtnClicked_flag";$(".promotion-link").click(function(){localStorage.setItem(t,!0)});if("product details"===(this.utag_data?.page_type||"other")){localStorage.getItem(t)&&(this.handleLimitedTimeOfferButtonClick(),localStorage.removeItem(t));const e=document.getElementById("inventory_promoMessage");e&&e.addEventListener("click",()=>{this.handleLimitedTimeOfferButtonClick()})}}handleLimitedTimeOfferButtonClick(){this.executeWithErrorHandling(()=>{this.utag_data.tealium_event="did_limited_time_offer_click",window.analyticsUtils.triggerUtagLink(this.utag_data,"did_limited_time_offer_click")},"Could not trigger limited time offer click event")}setupEcommerceEventListeners(){$(document).on("ecommerce_part_modify_cart",t=>{this.executeWithErrorHandling(()=>{t.data&&"ecommerce_part_modify_cart"===t.data.tealium_event&&!("ecomm_part_detail_inventory_class"in t.data)&&(t.data.ecomm_part_detail_inventory_class="Part"),t.data&&"ecommerce_part_cart_action"===t.data.tealium_event&&(t.data.ecomm_part_detail_inventory_class="Part")},"Error processing eCommerce event")}),window.utag_data=this.utag_data}handleWindowLoad(){const{pageType:t,referenceError:e}=this.config;"search"!==t&&"product details"!==t||(this.utag_data.digital_retailing_active=document.getElementsByClassName("boatyard-btn").length>0?1:0,this.utag_data.reserve_a_unit_active=document.querySelectorAll("#reserveUnitBtn").length>0?1:0);var o=$(".component[class*='PSS-component_']").length>=1,r=$(".component[class*='OEMPartsLookup_']").length>=1;o&&!r||this.triggerUtagView(),window.formHandler&&(window.formHandler.setTrackingCallback((t,e)=>{this.triggerUtagLink(t,e)}),window.formHandler.setupFormTracking(),window.formHandler.setupFormSubmissionTracking()),window.utag_data=this.utag_data}updateUtagData(t){this.utag_data=$.extend({},this.utag_data,t),window.utag_data=this.utag_data}getUtagData(){return this.utag_data}}window.analyticsUtils=new AnalyticsUtils,window.productHandler=new ProductHandler,window.eventHandler=new EventHandler,window.formHandler=new FormHandler,window.pageHandlers=new PageHandlers,window.analyticsManager=new AnalyticsManager,window.TriggerOfferedServicesFormLoad=function(t){return window.formHandler.TriggerOfferedServicesFormLoad(t)},window.TriggerUtagFormLoad=function(t){return window.formHandler.TriggerUtagFormLoad(t)};
